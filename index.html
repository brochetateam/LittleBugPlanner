<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Bug's Planner | 42 Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Space Mono', monospace;
            background-color: #f0f8ff;
        }
        
        .bug-theme {
            background-color: #e6f9ff;
            border-left: 5px solid #4CAF50;
        }
        
        .bug-theme:hover {
            background-color: #d1f2ff;
            transform: translateY(-2px);
        }
        
        .header-bg {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
        }
        
        .task-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .task-card:hover {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .bug-icon {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
            background-color: #e0e0e0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s ease;
        }
        
        .column {
            min-height: 400px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .priority-high {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        
        .priority-medium {
            background-color: #fef3c7;
            color: #b45309;
        }
        
        .priority-low {
            background-color: #dbeafe;
            color: #1d4ed8;
        }
        
        .priority-review {
            background-color: #ede9fe;
            color: #5b21b6;
        }
        
        .dropzone {
            min-height: 100px;
            transition: background-color 0.2s;
        }
        
        .dropzone.active {
            background-color: rgba(76, 175, 80, 0.1);
            border: 2px dashed #4CAF50;
        }
        
        .ghost {
            opacity: 0.4;
            background: #c8ebfb;
        }
        
        .weekend-planner {
            display: none;
        }
        
        .day-column {
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }
        
        .day-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #4CAF50, transparent);
            margin: 10px 0;
            position: relative;
        }
        
        .day-divider::after {
            content: 'Mediodía';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.8);
            padding: 0 8px;
            font-size: 10px;
            color: #4CAF50;
            border-radius: 10px;
        }
        
        .time-slot {
            height: 250px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        
        .time-slot::after {
            content: '4 horas';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 10px;
            color: #888;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .morning-slot {
            border-left: 4px solid #FFD700;
        }
        
        .afternoon-slot {
            border-left: 4px solid #1E90FF;
        }
        
        .active-view {
            background-color: rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }
        
        .week-task {
            background-color: white;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: move;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .week-task:hover {
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="header-bg text-white py-6 px-4 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between">
            <div class="flex items-center space-x-4 mb-4 md:mb-0">
                <div class="bug-icon">
                    <i class="fas fa-bug text-4xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold">Little Bug's Planner</h1>
                    <p class="text-sm opacity-80">42 Academy Planning Tool</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex bg-white bg-opacity-20 rounded-full overflow-hidden">
                    <button id="planner-view-btn" class="px-4 py-2 active-view">LibFT</button>
                    <button id="weekend-view-btn" class="px-4 py-2">Planner</button>
                </div>
                <div class="bg-white bg-opacity-20 px-4 py-2 rounded-full flex items-center">
                    <i class="fas fa-user-graduate mr-2"></i>
                    <span>Student: Little Bug</span>
                </div>
                <div class="flex space-x-2">
                    <button id="export-data-btn" class="bg-blue-500 text-white px-3 py-2 rounded-full font-bold hover:bg-blue-600 transition text-sm">
                        <i class="fas fa-download mr-1"></i> Exportar
                    </button>
                    <button id="import-data-btn" class="bg-purple-500 text-white px-3 py-2 rounded-full font-bold hover:bg-purple-600 transition text-sm">
                        <i class="fas fa-upload mr-1"></i> Importar
                    </button>
                    <button id="new-task-btn" class="bg-white text-green-700 px-4 py-2 rounded-full font-bold hover:bg-gray-100 transition">
                        <i class="fas fa-plus mr-2"></i> New Task
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- LibFT Planner View -->
    <div id="libft-planner" class="container mx-auto px-4 py-8">
        <!-- Progress Overview -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8 bug-theme">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">LibFT Progress</h2>
            <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                <div class="w-full md:w-3/4 mb-4 md:mb-0">
                    <div class="flex justify-between mb-2">
                        <span class="font-bold">Project Completion</span>
                        <span id="completion-percentage" class="font-bold">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="flex space-x-4">
                    <div class="text-center">
                        <div id="done-count" class="text-2xl font-bold text-green-600">0</div>
                        <div class="text-sm text-gray-600">Tasks Done</div>
                    </div>
                    <div class="text-center">
                        <div id="progress-count" class="text-2xl font-bold text-yellow-600">0</div>
                        <div class="text-sm text-gray-600">In Progress</div>
                    </div>
                    <div class="text-center">
                        <div id="todo-count" class="text-2xl font-bold text-red-600">0</div>
                        <div class="text-sm text-gray-600">Todo</div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                <div class="bg-green-100 p-4 rounded-lg flex items-center">
                    <div class="bg-green-500 text-white p-3 rounded-full mr-4">
                        <i class="fas fa-check"></i>
                    </div>
                    <div>
                        <h3 class="font-bold">Last Completed</h3>
                        <p id="last-completed" class="text-sm">-</p>
                    </div>
                </div>
                <div class="bg-yellow-100 p-4 rounded-lg flex items-center">
                    <div class="bg-yellow-500 text-white p-3 rounded-full mr-4">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <div>
                        <h3 class="font-bold">Current Task</h3>
                        <p id="current-task" class="text-sm">-</p>
                    </div>
                </div>
                <div class="bg-blue-100 p-4 rounded-lg flex items-center">
                    <div class="bg-blue-500 text-white p-3 rounded-full mr-4">
                        <i class="fas fa-flag"></i>
                    </div>
                    <div>
                        <h3 class="font-bold">Next Priority</h3>
                        <p id="next-priority" class="text-sm">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Task Board -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="task-board">
            <!-- Todo Column -->
            <div class="column p-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-red-600 flex items-center">
                        <i class="fas fa-list-ul mr-2"></i> To Do
                    </h3>
                    <span id="todo-count-badge" class="bg-red-100 text-red-800 text-xs font-bold px-2 py-1 rounded-full">0 tasks</span>
                </div>
                
                <div class="space-y-4 task-list dropzone" data-status="todo">
                    <!-- Task cards will be added here dynamically -->
                </div>
                
                <button class="mt-4 w-full py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-600 font-medium transition flex items-center justify-center add-task-btn" data-status="todo">
                    <i class="fas fa-plus mr-2"></i> Add Task
                </button>
            </div>
            
            <!-- In Progress Column -->
            <div class="column p-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-yellow-600 flex items-center">
                        <i class="fas fa-spinner mr-2"></i> In Progress
                    </h3>
                    <span id="progress-count-badge" class="bg-yellow-100 text-yellow-800 text-xs font-bold px-2 py-1 rounded-full">0 tasks</span>
                </div>
                
                <div class="space-y-4 task-list dropzone" data-status="progress">
                    <!-- Task cards will be added here dynamically -->
                </div>
                
                <button class="mt-4 w-full py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-600 font-medium transition flex items-center justify-center add-task-btn" data-status="progress">
                    <i class="fas fa-plus mr-2"></i> Add Task
                </button>
            </div>
            
            <!-- Done Column -->
            <div class="column p-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-green-600 flex items-center">
                        <i class="fas fa-check-circle mr-2"></i> Done
                    </h3>
                    <span id="done-count-badge" class="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded-full">0 tasks</span>
                </div>
                
                <div class="space-y-4 task-list dropzone" data-status="done">
                    <!-- Task cards will be added here dynamically -->
                </div>
                
                <button class="mt-4 w-full py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-600 font-medium transition flex items-center justify-center add-task-btn" data-status="done">
                    <i class="fas fa-plus mr-2"></i> Add Task
                </button>
            </div>
        </div>
        
        <!-- Resources Section -->
        <div class="mt-12 bg-white rounded-xl shadow-md p-6 bug-theme">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                <i class="fas fa-book mr-3"></i> LibFT Resources
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 hover:border-green-400 transition">
                    <div class="flex items-center mb-3">
                        <div class="bg-green-100 p-2 rounded-full mr-3">
                            <i class="fas fa-file-alt text-green-600"></i>
                        </div>
                        <h3 class="font-bold">Subject PDF</h3>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">Official LibFT project subject with requirements and instructions.</p>
                    <button class="w-full bg-green-50 text-green-700 py-2 rounded-lg font-medium hover:bg-green-100 transition flex items-center justify-center">
                        <i class="fas fa-download mr-2"></i> Download
                    </button>
                </div>
                
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 hover:border-blue-400 transition">
                    <div class="flex items-center mb-3">
                        <div class="bg-blue-100 p-2 rounded-full mr-3">
                            <i class="fas fa-video text-blue-600"></i>
                        </div>
                        <h3 class="font-bold">Tutorial Videos</h3>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">Collection of helpful tutorials from 42 peers and mentors.</p>
                    <button class="w-full bg-blue-50 text-blue-700 py-2 rounded-lg font-medium hover:bg-blue-100 transition flex items-center justify-center">
                        <i class="fas fa-play mr-2"></i> Watch Now
                    </button>
                </div>
                
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 hover:border-purple-400 transition">
                    <div class="flex items-center mb-3">
                        <div class="bg-purple-100 p-2 rounded-full mr-3">
                            <i class="fas fa-code text-purple-600"></i>
                        </div>
                        <h3 class="font-bold">Testers</h3>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">LibFT testers to validate your functions before evaluation.</p>
                    <button class="w-full bg-purple-50 text-purple-700 py-2 rounded-lg font-medium hover:bg-purple-100 transition flex items-center justify-center">
                        <i class="fas fa-flask mr-2"></i> Run Tests
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Weekend Planner View -->
    <div id="weekend-planner" class="weekend-planner container mx-auto px-4 py-8">
        <div class="bg-white rounded-xl shadow-md p-6 mb-8 bug-theme">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Weekend Planner</h2>
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <i class="fas fa-calendar-week mr-3 text-xl text-green-600"></i>
                    <h3 class="text-lg font-semibold">Current Week: <span id="current-week">Loading...</span></h3>
                </div>
                <button id="add-week-task" class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition flex items-center">
                    <i class="fas fa-plus mr-2"></i> Add Task
                </button>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-4">
                <!-- Monday -->
                <div class="day-column p-3">
                    <h4 class="font-bold text-center mb-3">Monday</h4>
                    <div class="morning-slot time-slot p-2 dropzone" data-day="monday" data-time="morning">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-sun mr-1 text-yellow-500"></i> Morning</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="monday" data-time="morning"></div>
                    </div>
                    <div class="day-divider"></div>
                    <div class="afternoon-slot time-slot p-2 dropzone" data-day="monday" data-time="afternoon">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-cloud-sun mr-1 text-blue-500"></i> Afternoon</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="monday" data-time="afternoon"></div>
                    </div>
                </div>
                
                <!-- Tuesday -->
                <div class="day-column p-3">
                    <h4 class="font-bold text-center mb-3">Tuesday</h4>
                    <div class="morning-slot time-slot p-2 dropzone" data-day="tuesday" data-time="morning">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-sun mr-1 text-yellow-500"></i> Morning</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="tuesday" data-time="morning"></div>
                    </div>
                    <div class="day-divider"></div>
                    <div class="afternoon-slot time-slot p-2 dropzone" data-day="tuesday" data-time="afternoon">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-cloud-sun mr-1 text-blue-500"></i> Afternoon</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="tuesday" data-time="afternoon"></div>
                    </div>
                </div>
                
                <!-- Wednesday -->
                <div class="day-column p-3">
                    <h4 class="font-bold text-center mb-3">Wednesday</h4>
                    <div class="morning-slot time-slot p-2 dropzone" data-day="wednesday" data-time="morning">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-sun mr-1 text-yellow-500"></i> Morning</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="wednesday" data-time="morning"></div>
                    </div>
                    <div class="day-divider"></div>
                    <div class="afternoon-slot time-slot p-2 dropzone" data-day="wednesday" data-time="afternoon">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-cloud-sun mr-1 text-blue-500"></i> Afternoon</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="wednesday" data-time="afternoon"></div>
                    </div>
                </div>
                
                <!-- Thursday -->
                <div class="day-column p-3">
                    <h4 class="font-bold text-center mb-3">Thursday</h4>
                    <div class="morning-slot time-slot p-2 dropzone" data-day="thursday" data-time="morning">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-sun mr-1 text-yellow-500"></i> Morning</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="thursday" data-time="morning"></div>
                    </div>
                    <div class="day-divider"></div>
                    <div class="afternoon-slot time-slot p-2 dropzone" data-day="thursday" data-time="afternoon">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-cloud-sun mr-1 text-blue-500"></i> Afternoon</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="thursday" data-time="afternoon"></div>
                    </div>
                </div>
                
                <!-- Friday -->
                <div class="day-column p-3">
                    <h4 class="font-bold text-center mb-3">Friday</h4>
                    <div class="morning-slot time-slot p-2 dropzone" data-day="friday" data-time="morning">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-sun mr-1 text-yellow-500"></i> Morning</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="friday" data-time="morning"></div>
                    </div>
                    <div class="day-divider"></div>
                    <div class="afternoon-slot time-slot p-2 dropzone" data-day="friday" data-time="afternoon">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-cloud-sun mr-1 text-blue-500"></i> Afternoon</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="friday" data-time="afternoon"></div>
                    </div>
                </div>
                
                <!-- Saturday -->
                <div class="day-column p-3">
                    <h4 class="font-bold text-center mb-3">Saturday</h4>
                    <div class="morning-slot time-slot p-2 dropzone" data-day="saturday" data-time="morning">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-sun mr-1 text-yellow-500"></i> Morning</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="saturday" data-time="morning"></div>
                    </div>
                    <div class="day-divider"></div>
                    <div class="afternoon-slot time-slot p-2 dropzone" data-day="saturday" data-time="afternoon">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-cloud-sun mr-1 text-blue-500"></i> Afternoon</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="saturday" data-time="afternoon"></div>
                    </div>
                </div>
                
                <!-- Sunday -->
                <div class="day-column p-3">
                    <h4 class="font-bold text-center mb-3">Sunday</h4>
                    <div class="morning-slot time-slot p-2 dropzone" data-day="sunday" data-time="morning">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-sun mr-1 text-yellow-500"></i> Morning</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="sunday" data-time="morning"></div>
                    </div>
                    <div class="day-divider"></div>
                    <div class="afternoon-slot time-slot p-2 dropzone" data-day="sunday" data-time="afternoon">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium"><i class="fas fa-cloud-sun mr-1 text-blue-500"></i> Afternoon</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded-full">0 tasks</span>
                        </div>
                        <div class="week-tasks" data-day="sunday" data-time="afternoon"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Modal -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-xl font-bold">New Task</h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="task-form">
                <input type="hidden" id="task-id">
                <input type="hidden" id="task-view" value="planner">
                
                <div class="mb-4">
                    <label for="task-title" class="block text-sm font-medium text-gray-700 mb-1">Task Title</label>
                    <input type="text" id="task-title" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" required>
                </div>
                
                <div class="mb-4">
                    <label for="task-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="task-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                </div>
                
                <div id="planner-fields">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="task-priority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                            <select id="task-priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                                <option value="review">Review</option>
                            </select>
                        </div>
                        <div>
                            <label for="task-due" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                            <input type="date" id="task-due" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="task-type" class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                        <select id="task-type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="mandatory">Mandatory</option>
                            <option value="bonus">Bonus</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="task-status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select id="task-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="todo">To Do</option>
                            <option value="progress">In Progress</option>
                            <option value="done">Done</option>
                        </select>
                    </div>
                </div>
                
                <div id="weekend-fields" class="hidden">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="task-day" class="block text-sm font-medium text-gray-700 mb-1">Day</label>
                            <select id="task-day" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="monday">Monday</option>
                                <option value="tuesday">Tuesday</option>
                                <option value="wednesday">Wednesday</option>
                                <option value="thursday">Thursday</option>
                                <option value="friday">Friday</option>
                                <option value="saturday">Saturday</option>
                                <option value="sunday">Sunday</option>
                            </select>
                        </div>
                        <div>
                            <label for="task-time" class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                            <select id="task-time" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="morning">Morning</option>
                                <option value="afternoon">Afternoon</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="task-duration" class="block text-sm font-medium text-gray-700 mb-1">Duration (hours)</label>
                        <input type="number" id="task-duration" min="0.5" max="8" step="0.5" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" id="delete-task" class="px-4 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition hidden">
                        Delete
                    </button>
                    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition">
                        Save Task
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <div class="mr-3 text-2xl">
                        <i class="fas fa-bug"></i>
                    </div>
                    <div>
                        <div class="font-bold">Little Bug's Planner</div>
                        <div class="text-xs text-gray-400">42 Academy Planning Tool</div>
                    </div>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="hover:text-green-400 transition">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="#" class="hover:text-green-400 transition">
                        <i class="fab fa-slack"></i>
                    </a>
                    <a href="#" class="hover:text-green-400 transition">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-700 text-center text-sm text-gray-400">
                Made with <i class="fas fa-heart text-red-400"></i> for 42 Academy by Little Bug
            </div>
        </div>
    </footer>

    <script>
        // Sample tasks data
        let tasks = [
            {
                id: 1,
                title: "ft_split",
                description: "Implement string splitting function with specified delimiter",
                priority: "high",
                due: "2023-07-15",
                type: "mandatory",
                status: "todo",
                completedDate: null,
                view: "planner"
            },
            {
                id: 2,
                title: "ft_substr",
                description: "Create substring from given string with start index and length",
                priority: "medium",
                due: "2023-07-18",
                type: "mandatory",
                status: "todo",
                completedDate: null,
                view: "planner"
            },
            {
                id: 3,
                title: "Bonus: ft_lstnew",
                description: "Create new element for linked list (bonus part)",
                priority: "low",
                due: "2023-07-25",
                type: "bonus",
                status: "todo",
                completedDate: null,
                view: "planner"
            },
            {
                id: 4,
                title: "ft_strjoin",
                description: "Concatenate two strings into a new string (allocated)",
                priority: "high",
                due: "2023-07-14",
                type: "mandatory",
                status: "progress",
                completedDate: null,
                view: "planner"
            },
            {
                id: 5,
                title: "ft_itoa",
                description: "Convert integer to string representation",
                priority: "review",
                due: "2023-07-16",
                type: "mandatory",
                status: "progress",
                completedDate: null,
                view: "planner"
            },
            {
                id: 6,
                title: "ft_memmove",
                description: "Implement memory move function with overlap handling",
                priority: "low",
                due: "2023-07-19",
                type: "mandatory",
                status: "progress",
                completedDate: null,
                view: "planner"
            },
            {
                id: 7,
                title: "ft_strlen",
                description: "Calculate length of a string",
                priority: "high",
                due: "2023-07-12",
                type: "mandatory",
                status: "done",
                completedDate: "2023-07-12",
                view: "planner"
            },
            {
                id: 8,
                title: "ft_strdup",
                description: "Duplicate a string with memory allocation",
                priority: "medium",
                due: "2023-07-11",
                type: "mandatory",
                status: "done",
                completedDate: "2023-07-11",
                view: "planner"
            },
            {
                id: 9,
                title: "ft_isalpha",
                description: "Check if character is alphabetic",
                priority: "low",
                due: "2023-07-10",
                type: "mandatory",
                status: "done",
                completedDate: "2023-07-09",
                view: "planner"
            },
            // Weekend tasks
            {
                id: 10,
                title: "Study pointers",
                description: "Review pointer arithmetic and memory management",
                day: "monday",
                time: "morning",
                duration: 2,
                view: "weekend"
            },
            {
                id: 11,
                title: "Work on LibFT",
                description: "Implement ft_strjoin and ft_substr functions",
                day: "monday",
                time: "afternoon",
                duration: 3,
                view: "weekend"
            },
            {
                id: 12,
                title: "Peer learning",
                description: "Meet with study group to review progress",
                day: "wednesday",
                time: "afternoon",
                duration: 1.5,
                view: "weekend"
            },
            {
                id: 13,
                title: "Self-evaluation",
                description: "Test all completed functions with personal tester",
                day: "saturday",
                time: "morning",
                duration: 2,
                view: "weekend"
            }
        ];

        // DOM elements
        const libftPlanner = document.getElementById('libft-planner');
        const weekendPlanner = document.getElementById('weekend-planner');
        const plannerViewBtn = document.getElementById('planner-view-btn');
        const weekendViewBtn = document.getElementById('weekend-view-btn');
        const taskBoard = document.getElementById('task-board');
        const taskModal = document.getElementById('task-modal');
        const taskForm = document.getElementById('task-form');
        const closeModal = document.getElementById('close-modal');
        const newTaskBtn = document.getElementById('new-task-btn');
        const addWeekTaskBtn = document.getElementById('add-week-task');
        const addTaskBtns = document.querySelectorAll('.add-task-btn');
        const deleteTaskBtn = document.getElementById('delete-task');
        const plannerFields = document.getElementById('planner-fields');
        const weekendFields = document.getElementById('weekend-fields');
        const currentWeekDisplay = document.getElementById('current-week');
        
        // Stats elements
        const completionPercentage = document.getElementById('completion-percentage');
        const progressFill = document.getElementById('progress-fill');
        const doneCount = document.getElementById('done-count');
        const progressCount = document.getElementById('progress-count');
        const todoCount = document.getElementById('todo-count');
        const lastCompleted = document.getElementById('last-completed');
        const currentTask = document.getElementById('current-task');
        const nextPriority = document.getElementById('next-priority');
        const todoCountBadge = document.getElementById('todo-count-badge');
        const progressCountBadge = document.getElementById('progress-count-badge');
        const doneCountBadge = document.getElementById('done-count-badge');

        // Initialize the app
        function init() {
            loadTasksFromLocalStorage();
            renderTasks();
            updateStats();
            setupEventListeners();
            updateCurrentWeekDisplay();
        }
        
        // Exportar tareas a un archivo JSON
        function exportTasks() {
            const dataStr = JSON.stringify(tasks, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'little-bug-planner-data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // Importar tareas desde un archivo JSON
        function importTasks() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                
                if (!file) {
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        // Validar que los datos importados tienen la estructura correcta
                        if (Array.isArray(importedData) && importedData.length > 0) {
                            // Verificar que al menos el primer elemento tiene la estructura esperada
                            const firstItem = importedData[0];
                            if (firstItem && (firstItem.view === 'planner' || firstItem.view === 'weekend')) {
                                // Los datos parecen válidos, proceder con la importación
                                tasks = importedData;
                                saveTasksToLocalStorage();
                                renderTasks();
                                updateStats();
                                alert('¡Datos importados correctamente!');
                            } else {
                                alert('El archivo no contiene datos de tareas válidos.');
                            }
                        } else {
                            alert('El archivo no contiene un array de tareas válido.');
                        }
                    } catch (error) {
                        console.error('Error al importar datos:', error);
                        alert('Error al importar el archivo. Asegúrate de que es un JSON válido.');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // Save tasks to localStorage
        function saveTasksToLocalStorage() {
            localStorage.setItem('littleBugTasks', JSON.stringify(tasks));
        }
        
        // Load tasks from localStorage
        function loadTasksFromLocalStorage() {
            const savedTasks = localStorage.getItem('littleBugTasks');
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }
        }

        // Render all tasks to the board
        function renderTasks() {
            // Clear all task lists
            document.querySelectorAll('.task-list').forEach(list => {
                list.innerHTML = '';
            });
            
            // Clear all week tasks
            document.querySelectorAll('.week-tasks').forEach(list => {
                list.innerHTML = '';
            });
            
            // Render each task
            tasks.forEach(task => {
                if (task.view === 'planner') {
                    renderPlannerTask(task);
                } else if (task.view === 'weekend') {
                    renderWeekendTask(task);
                }
            });
            
            // Update task counts in weekend planner
            updateWeekendTaskCounts();
        }

        // Render a single planner task to the board
        function renderPlannerTask(task) {
            const taskList = document.querySelector(`.task-list[data-status="${task.status}"]`);
            
            if (!taskList) return;
            
            const taskElement = document.createElement('div');
            taskElement.className = `task-card bg-white p-4 rounded-lg shadow-sm border-l-4 cursor-move ${getBorderClass(task)}`;
            taskElement.setAttribute('draggable', 'true');
            taskElement.setAttribute('data-task-id', task.id);
            
            if (task.status === 'done') {
                taskElement.classList.add('opacity-90');
            }
            
            const dueText = task.status === 'done' ? 
                `Completed: ${formatCompletedDate(task.completedDate)}` : 
                `Due: ${formatDueDate(task.due)}`;
            
            taskElement.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-bold text-gray-800">${task.title}</h4>
                    <div class="flex space-x-2">
                        <span class="${getPriorityClass(task)} text-xs px-2 py-1 rounded-full">${formatPriority(task.priority)}</span>
                        <button class="edit-task text-gray-400 hover:text-gray-600">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mb-3">${task.description}</p>
                <div class="flex justify-between items-center text-xs text-gray-500">
                    <div class="flex items-center">
                        <i class="far fa-clock mr-1"></i>
                        <span>${dueText}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="${task.type === 'bonus' ? 'fas fa-star' : 'fas fa-code-branch'} mr-1"></i>
                        <span>${task.type === 'bonus' ? 'Bonus' : 'Mandatory'}</span>
                    </div>
                </div>
                ${task.status === 'progress' ? `
                <div class="mt-2">
                    <div class="flex items-center">
                        <div class="w-8 h-8 ${getUserStatusClass(task)} rounded-full flex items-center justify-center text-xs font-bold">LB</div>
                        <div class="ml-2 text-xs text-gray-600">${getUserStatusText(task)}</div>
                    </div>
                </div>` : ''}
            `;
            
            taskList.appendChild(taskElement);
            
            // Add event listeners to the task
            const editBtn = taskElement.querySelector('.edit-task');
            editBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                openEditModal(task.id);
            });
            
            // Add double-click event for editing
            taskElement.addEventListener('dblclick', () => openEditModal(task.id));
        }

        // Render a single weekend task to the board
        function renderWeekendTask(task) {
            const taskList = document.querySelector(`.week-tasks[data-day="${task.day}"][data-time="${task.time}"]`);
            
            if (!taskList) return;
            
            const taskElement = document.createElement('div');
            taskElement.className = 'week-task';
            taskElement.setAttribute('draggable', 'true');
            taskElement.setAttribute('data-task-id', task.id);
            
            // Añadir clase de advertencia si la duración excede 4 horas
            const durationClass = task.duration > 4 ? 'bg-red-100 border border-red-300' : '';
            
            taskElement.innerHTML = `
                <div class="flex justify-between items-start mb-1">
                    <h4 class="font-bold text-sm text-gray-800">${task.title}</h4>
                    <div class="flex space-x-2">
                        <span class="text-xs ${task.duration > 4 ? 'bg-red-100 text-red-800' : 'bg-gray-100'} px-2 py-1 rounded-full">${task.duration}h ${task.duration > 4 ? '⚠️' : ''}</span>
                        <button class="edit-task text-gray-400 hover:text-gray-600 text-sm">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                <p class="text-xs text-gray-600">${task.description}</p>
                ${task.duration > 4 ? '<p class="text-xs text-red-600 mt-1">⚠️ Excede el límite de 4 horas</p>' : ''}
            `;
            
            taskList.appendChild(taskElement);
            
            // Añadir clase de advertencia al elemento si excede 4 horas
            if (task.duration > 4) {
                taskElement.classList.add('bg-red-50', 'border', 'border-red-200');
            }
            
            // Add event listeners to the task
            const editBtn = taskElement.querySelector('.edit-task');
            editBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                openEditModal(task.id);
            });
            
            // Add double-click event for editing
            taskElement.addEventListener('dblclick', () => openEditModal(task.id));
        }

        // Get border class based on task status
        function getBorderClass(task) {
            if (task.status === 'todo') return 'border-red-500';
            if (task.status === 'progress') return 'border-yellow-500';
            if (task.status === 'done') return 'border-green-500';
            return 'border-gray-500';
        }

        // Get priority class based on task priority
        function getPriorityClass(task) {
            if (task.priority === 'high') return 'priority-high';
            if (task.priority === 'medium') return 'priority-medium';
            if (task.priority === 'low') return 'priority-low';
            if (task.priority === 'review') return 'priority-review';
            return 'bg-gray-100 text-gray-800';
        }

        // Get user status class based on task priority
        function getUserStatusClass(task) {
            if (task.priority === 'high') return 'bg-green-200';
            if (task.priority === 'medium') return 'bg-yellow-200';
            if (task.priority === 'review') return 'bg-purple-200';
            return 'bg-blue-200';
        }

        // Get user status text based on task priority
        function getUserStatusText(task) {
            if (task.priority === 'high') return 'Working on it';
            if (task.priority === 'medium') return 'In progress';
            if (task.priority === 'review') return 'Needs testing';
            return 'Started';
        }

        // Format priority for display
        function formatPriority(priority) {
            return priority.charAt(0).toUpperCase() + priority.slice(1);
        }

        // Format due date for display
        function formatDueDate(dateString) {
            if (!dateString) return 'No due date';
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const dueDate = new Date(dateString);
            dueDate.setHours(0, 0, 0, 0);
            
            const diffTime = dueDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Tomorrow';
            if (diffDays === -1) return 'Yesterday';
            if (diffDays < 0) return `${Math.abs(diffDays)} days ago`;
            
            return `In ${diffDays} days`;
        }

        // Format completed date for display
        function formatCompletedDate(dateString) {
            if (!dateString) return 'Recently';
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const completedDate = new Date(dateString);
            completedDate.setHours(0, 0, 0, 0);
            
            const diffTime = today - completedDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            
            return `${diffDays} days ago`;
        }

        // Update task counts in weekend planner
        function updateWeekendTaskCounts() {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const times = ['morning', 'afternoon'];
            
            days.forEach(day => {
                times.forEach(time => {
                    const tasksInSlot = tasks.filter(task => 
                        task.view === 'weekend' && 
                        task.day === day && 
                        task.time === time
                    );
                    
                    const count = tasksInSlot.length;
                    const totalHours = tasksInSlot.reduce((sum, task) => sum + task.duration, 0);
                    const hoursPercentage = Math.min(totalHours / 4 * 100, 100);
                    
                    const badge = document.querySelector(`.time-slot[data-day="${day}"][data-time="${time}"] .text-xs`);
                    const timeSlot = document.querySelector(`.time-slot[data-day="${day}"][data-time="${time}"]`);
                    
                    if (badge) {
                        badge.textContent = `${count} ${count === 1 ? 'task' : 'tasks'} (${totalHours}/4h)`;
                        badge.className = totalHours > 4 ? 'text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full' : 'text-xs bg-gray-100 px-2 py-1 rounded-full';
                    }
                    
                    // Añadir barra de progreso para mostrar visualmente las horas utilizadas
                    let progressBar = timeSlot.querySelector('.hours-progress');
                    
                    if (!progressBar) {
                        progressBar = document.createElement('div');
                        progressBar.className = 'hours-progress w-full h-1 bg-gray-200 mt-1 rounded-full overflow-hidden';
                        const progressFill = document.createElement('div');
                        progressFill.className = 'h-full rounded-full';
                        progressBar.appendChild(progressFill);
                        
                        // Insertar después del encabezado del bloque de tiempo
                        const header = timeSlot.querySelector('.flex.items-center.justify-between');
                        if (header && header.nextSibling) {
                            timeSlot.insertBefore(progressBar, header.nextSibling);
                        } else {
                            timeSlot.appendChild(progressBar);
                        }
                    }
                    
                    const progressFill = progressBar.querySelector('div');
                    progressFill.style.width = `${hoursPercentage}%`;
                    progressFill.style.backgroundColor = totalHours > 4 ? '#f87171' : (totalHours > 3 ? '#fcd34d' : '#4ade80');
                    progressFill.title = `${totalHours}/4 horas utilizadas`;
                    
                    // Cambiar el estilo del bloque de tiempo si está sobrecargado
                    if (totalHours > 4) {
                        timeSlot.classList.add('border', 'border-red-300', 'bg-red-50');
                    } else {
                        timeSlot.classList.remove('border', 'border-red-300', 'bg-red-50');
                    }
                });
            });
        }

        // Update current week display
        function updateCurrentWeekDisplay() {
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay() + 1); // Monday
            const endOfWeek = new Date(now);
            endOfWeek.setDate(now.getDate() - now.getDay() + 7); // Sunday
            
            const options = { month: 'short', day: 'numeric' };
            const startStr = startOfWeek.toLocaleDateString(undefined, options);
            const endStr = endOfWeek.toLocaleDateString(undefined, options);
            
            currentWeekDisplay.textContent = `${startStr} - ${endStr}`;
        }

        // Update statistics
        function updateStats() {
            const plannerTasks = tasks.filter(task => task.view === 'planner');
            const totalTasks = plannerTasks.length;
            const doneTasks = plannerTasks.filter(task => task.status === 'done').length;
            const progressTasks = plannerTasks.filter(task => task.status === 'progress').length;
            const todoTasks = plannerTasks.filter(task => task.status === 'todo').length;
            
            // Update counts
            doneCount.textContent = doneTasks;
            progressCount.textContent = progressTasks;
            todoCount.textContent = todoTasks;
            
            // Update badges
            todoCountBadge.textContent = `${todoTasks} ${todoTasks === 1 ? 'task' : 'tasks'}`;
            progressCountBadge.textContent = `${progressTasks} ${progressTasks === 1 ? 'task' : 'tasks'}`;
            doneCountBadge.textContent = `${doneTasks} ${doneTasks === 1 ? 'task' : 'tasks'}`;
            
            // Update completion percentage
            const percentage = totalTasks > 0 ? Math.round((doneTasks / totalTasks) * 100) : 0;
            completionPercentage.textContent = `${percentage}%`;
            progressFill.style.width = `${percentage}%`;
            
            // Update last completed task
            const completedTasks = plannerTasks.filter(task => task.status === 'done')
                .sort((a, b) => new Date(b.completedDate) - new Date(a.completedDate));
            
            lastCompleted.textContent = completedTasks.length > 0 ? completedTasks[0].title : '-';
            
            // Update current task (first in progress task by priority)
            const inProgressTasks = plannerTasks.filter(task => task.status === 'progress')
                .sort((a, b) => {
                    const priorityOrder = { 'high': 0, 'medium': 1, 'low': 2, 'review': 3 };
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                });
            
            currentTask.textContent = inProgressTasks.length > 0 ? inProgressTasks[0].title : '-';
            
            // Update next priority (first todo task by priority)
            const todoTasksSorted = plannerTasks.filter(task => task.status === 'todo')
                .sort((a, b) => {
                    const priorityOrder = { 'high': 0, 'medium': 1, 'low': 2, 'review': 3 };
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                });
            
            nextPriority.textContent = todoTasksSorted.length > 0 ? todoTasksSorted[0].title : '-';
        }

        // Setup event listeners
        function setupEventListeners() {
            // View toggle buttons
            plannerViewBtn.addEventListener('click', () => {
                libftPlanner.style.display = 'block';
                weekendPlanner.style.display = 'none';
                plannerViewBtn.classList.add('active-view');
                weekendViewBtn.classList.remove('active-view');
                document.getElementById('task-view').value = 'planner';
            });
            
            weekendViewBtn.addEventListener('click', () => {
                libftPlanner.style.display = 'none';
                weekendPlanner.style.display = 'block';
                plannerViewBtn.classList.remove('active-view');
                weekendViewBtn.classList.add('active-view');
                document.getElementById('task-view').value = 'weekend';
            });
            
            // New task button
            newTaskBtn.addEventListener('click', () => {
                const currentView = weekendPlanner.style.display === 'block' ? 'weekend' : 'planner';
                openNewModal(currentView);
            });
            
            // Add week task button
            addWeekTaskBtn.addEventListener('click', () => openNewModal('weekend'));
            
            // Add task buttons in each column
            addTaskBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const status = btn.getAttribute('data-status');
                    openNewModal('planner', status);
                });
            });
            
            // Close modal button
            closeModal.addEventListener('click', () => closeTaskModal());
            
            // Task form submission
            taskForm.addEventListener('submit', handleTaskSubmit);
            
            // Delete task button
            deleteTaskBtn.addEventListener('click', handleDeleteTask);
            
            // Exportar e importar datos
            document.getElementById('export-data-btn').addEventListener('click', exportTasks);
            document.getElementById('import-data-btn').addEventListener('click', importTasks);
            
            // Drag and drop functionality
            setupDragAndDrop();
        }

        // Setup drag and drop with improved functionality
        function setupDragAndDrop() {
            let draggedItem = null;
            let dropzone = null;
            let ghostElement = null;
            
            // Add event listeners to all task cards
            document.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('task-card') || e.target.classList.contains('week-task')) {
                    draggedItem = e.target;
                    
                    if (e.target.classList.contains('task-card')) {
                        e.target.classList.add('dragging');
                    }
                    
                    // Create a ghost element for better visual feedback
                    ghostElement = e.target.cloneNode(true);
                    ghostElement.classList.add('ghost');
                    ghostElement.style.position = 'absolute';
                    ghostElement.style.pointerEvents = 'none';
                    ghostElement.style.width = `${e.target.offsetWidth}px`;
                    document.body.appendChild(ghostElement);
                    
                    // Set the drag image to be transparent
                    e.dataTransfer.setDragImage(new Image(), 0, 0);
                }
            });
            
            document.addEventListener('dragend', function(e) {
                if (draggedItem) {
                    if (draggedItem.classList.contains('task-card')) {
                        draggedItem.classList.remove('dragging');
                    }
                    
                    // Remove ghost element
                    if (ghostElement) {
                        ghostElement.remove();
                        ghostElement = null;
                    }
                    
                    // Reset dropzone highlighting
                    if (dropzone) {
                        dropzone.classList.remove('active');
                        dropzone = null;
                    }
                    
                    draggedItem = null;
                }
            });
            
            // Handle dragover for dropzones
            document.addEventListener('dragover', function(e) {
                e.preventDefault();
                
                // Update ghost position
                if (ghostElement) {
                    ghostElement.style.top = `${e.clientY - 20}px`;
                    ghostElement.style.left = `${e.clientX - 20}px`;
                }
                
                // Find the closest dropzone
                const element = document.elementFromPoint(e.clientX, e.clientY);
                const newDropzone = element?.closest('.dropzone');
                
                // Update dropzone highlighting
                if (newDropzone !== dropzone) {
                    if (dropzone) {
                        dropzone.classList.remove('active');
                    }
                    dropzone = newDropzone;
                    if (dropzone) {
                        dropzone.classList.add('active');
                    }
                }
            });
            
            // Handle drop event
            document.addEventListener('drop', function(e) {
                e.preventDefault();
                
                if (draggedItem && dropzone) {
                    const taskId = parseInt(draggedItem.getAttribute('data-task-id'));
                    const task = tasks.find(t => t.id === taskId);
                    
                    if (!task) return;
                    
                    // Handle planner task drop
                    if (task.view === 'planner' && dropzone.hasAttribute('data-status')) {
                        const newStatus = dropzone.getAttribute('data-status');
                        
                        // Update task status
                        updateTaskStatus(taskId, newStatus);
                    }
                    
                    // Handle weekend task drop - permitir mover entre cualquier día y tiempo
                    else if (task.view === 'weekend' && dropzone.hasAttribute('data-day') && dropzone.hasAttribute('data-time')) {
                        const newDay = dropzone.getAttribute('data-day');
                        const newTime = dropzone.getAttribute('data-time');
                        
                        // Update task day/time
                        updateWeekendTaskTime(taskId, newDay, newTime);
                    }
                    
                    // Reset dropzone highlighting
                    if (dropzone) {
                        dropzone.classList.remove('active');
                        dropzone = null;
                    }
                }
                
                // Remove ghost element
                if (ghostElement) {
                    ghostElement.remove();
                    ghostElement = null;
                }
            });
            
            // Hacer que todas las zonas de tiempo sean dropzones válidas para cualquier tarea
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('active');
                });
                
                slot.addEventListener('dragleave', function() {
                    this.classList.remove('active');
                });
            });
        }

        // Update task status
        function updateTaskStatus(taskId, newStatus) {
            const taskIndex = tasks.findIndex(task => task.id === taskId);
            
            if (taskIndex !== -1 && tasks[taskIndex].view === 'planner') {
                // If moving to done, set completed date
                if (newStatus === 'done' && tasks[taskIndex].status !== 'done') {
                    tasks[taskIndex].completedDate = new Date().toISOString().split('T')[0];
                }
                
                // If moving away from done, clear completed date
                if (newStatus !== 'done' && tasks[taskIndex].status === 'done') {
                    tasks[taskIndex].completedDate = null;
                }
                
                tasks[taskIndex].status = newStatus;
                
                // Save to localStorage
                saveTasksToLocalStorage();
                
                // Re-render tasks and update stats
                renderTasks();
                updateStats();
            }
        }

        // Update weekend task day/time
        function updateWeekendTaskTime(taskId, newDay, newTime) {
            const taskIndex = tasks.findIndex(task => task.id === taskId);
            
            if (taskIndex !== -1 && tasks[taskIndex].view === 'weekend') {
                const taskToMove = tasks[taskIndex];
                const taskElement = document.querySelector(`.week-task[data-task-id="${taskId}"]`);
                
                // Verificar si hay capacidad en el nuevo bloque de tiempo
                const tasksInNewSlot = tasks.filter(t => 
                    t.view === 'weekend' && 
                    t.day === newDay && 
                    t.time === newTime && 
                    t.id !== taskId
                );
                
                const totalHours = tasksInNewSlot.reduce((sum, t) => sum + t.duration, 0);
                
                if (totalHours + taskToMove.duration > 4) {
                    alert(`No se puede mover la tarea. El bloque de tiempo ya tiene ${totalHours} horas asignadas y añadir ${taskToMove.duration} horas excedería el límite de 4 horas.`);
                    return;
                }
                
                // Si pasa la validación, actualizar la tarea
                tasks[taskIndex].day = newDay;
                tasks[taskIndex].time = newTime;
                
                // Mover el elemento en el DOM sin necesidad de volver a renderizar todo
                if (taskElement) {
                    // Remover el elemento de su ubicación actual
                    if (taskElement.parentNode) {
                        taskElement.parentNode.removeChild(taskElement);
                    }
                    
                    // Añadir el elemento a su nueva ubicación
                    const targetContainer = document.querySelector(`.week-tasks[data-day="${newDay}"][data-time="${newTime}"]`);
                    if (targetContainer) {
                        targetContainer.appendChild(taskElement);
                    }
                }
                
                // Save to localStorage
                saveTasksToLocalStorage();
                updateWeekendTaskCounts();
            }
        }

        // Open modal for new task
        function openNewModal(view = 'planner', status = 'todo') {
            document.getElementById('modal-title').textContent = 'New Task';
            document.getElementById('task-id').value = '';
            document.getElementById('task-title').value = '';
            document.getElementById('task-description').value = '';
            document.getElementById('task-view').value = view;
            
            if (view === 'planner') {
                document.getElementById('task-priority').value = 'medium';
                document.getElementById('task-due').value = '';
                document.getElementById('task-type').value = 'mandatory';
                document.getElementById('task-status').value = status;
                
                plannerFields.classList.remove('hidden');
                weekendFields.classList.add('hidden');
            } else {
                document.getElementById('task-day').value = 'monday';
                document.getElementById('task-time').value = 'morning';
                document.getElementById('task-duration').value = '1';
                
                plannerFields.classList.add('hidden');
                weekendFields.classList.remove('hidden');
            }
            
            // Hide delete button for new tasks
            deleteTaskBtn.classList.add('hidden');
            
            // Show modal
            taskModal.style.display = 'flex';
        }

        // Open modal for editing task
        function openEditModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            
            if (!task) return;
            
            document.getElementById('modal-title').textContent = 'Edit Task';
            document.getElementById('task-id').value = task.id;
            document.getElementById('task-title').value = task.title;
            document.getElementById('task-description').value = task.description;
            document.getElementById('task-view').value = task.view;
            
            if (task.view === 'planner') {
                document.getElementById('task-priority').value = task.priority;
                document.getElementById('task-due').value = task.due;
                document.getElementById('task-type').value = task.type;
                document.getElementById('task-status').value = task.status;
                
                plannerFields.classList.remove('hidden');
                weekendFields.classList.add('hidden');
            } else {
                document.getElementById('task-day').value = task.day;
                document.getElementById('task-time').value = task.time;
                document.getElementById('task-duration').value = task.duration;
                
                plannerFields.classList.add('hidden');
                weekendFields.classList.remove('hidden');
            }
            
            // Show delete button for existing tasks
            deleteTaskBtn.classList.remove('hidden');
            
            // Show modal
            taskModal.style.display = 'flex';
        }

        // Close task modal
        function closeTaskModal() {
            taskModal.style.display = 'none';
        }

        // Handle task form submission
        function handleTaskSubmit(e) {
            e.preventDefault();
            
            const taskId = document.getElementById('task-id').value;
            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const view = document.getElementById('task-view').value;
            
            // Validar duración máxima de 4 horas para tareas del planificador semanal
            if (view === 'weekend') {
                const duration = parseFloat(document.getElementById('task-duration').value);
                if (duration > 4) {
                    alert('Las tareas no pueden exceder 4 horas por bloque de tiempo. Por favor, ajuste la duración.');
                    return;
                }
                
                // Verificar si hay capacidad en el bloque de tiempo seleccionado
                if (!taskId) { // Solo para nuevas tareas
                    const day = document.getElementById('task-day').value;
                    const time = document.getElementById('task-time').value;
                    
                    const tasksInSlot = tasks.filter(t => 
                        t.view === 'weekend' && 
                        t.day === day && 
                        t.time === time
                    );
                    
                    const totalHours = tasksInSlot.reduce((sum, t) => sum + t.duration, 0);
                    
                    if (totalHours + duration > 4) {
                        alert(`Este bloque de tiempo ya tiene ${totalHours} horas asignadas. Añadir ${duration} horas excedería el límite de 4 horas.`);
                        return;
                    }
                }
            }
            
            if (taskId) {
                // Update existing task
                const taskIndex = tasks.findIndex(task => task.id === parseInt(taskId));
                
                if (taskIndex !== -1) {
                    if (view === 'planner') {
                        tasks[taskIndex] = {
                            ...tasks[taskIndex],
                            title,
                            description,
                            priority: document.getElementById('task-priority').value,
                            due: document.getElementById('task-due').value,
                            type: document.getElementById('task-type').value,
                            status: document.getElementById('task-status').value,
                            view
                        };
                    } else {
                        tasks[taskIndex] = {
                            ...tasks[taskIndex],
                            title,
                            description,
                            day: document.getElementById('task-day').value,
                            time: document.getElementById('task-time').value,
                            duration: parseFloat(document.getElementById('task-duration').value),
                            view
                        };
                    }
                }
            } else {
                // Create new task
                const newId = tasks.length > 0 ? Math.max(...tasks.map(task => task.id)) + 1 : 1;
                
                if (view === 'planner') {
                    tasks.push({
                        id: newId,
                        title,
                        description,
                        priority: document.getElementById('task-priority').value,
                        due: document.getElementById('task-due').value,
                        type: document.getElementById('task-type').value,
                        status: document.getElementById('task-status').value,
                        completedDate: document.getElementById('task-status').value === 'done' ? new Date().toISOString().split('T')[0] : null,
                        view
                    });
                } else {
                    tasks.push({
                        id: newId,
                        title,
                        description,
                        day: document.getElementById('task-day').value,
                        time: document.getElementById('task-time').value,
                        duration: parseFloat(document.getElementById('task-duration').value),
                        view
                    });
                }
            }
            
            // Save to localStorage
            saveTasksToLocalStorage();
            
            // Re-render tasks and update stats
            renderTasks();
            updateStats();
            
            // Close modal
            closeTaskModal();
        }

        // Handle task deletion
        function handleDeleteTask() {
            const taskId = parseInt(document.getElementById('task-id').value);
            
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(task => task.id !== taskId);
                
                // Save to localStorage
                saveTasksToLocalStorage();
                
                // Re-render tasks and update stats
                renderTasks();
                updateStats();
                
                // Close modal
                closeTaskModal();
            }
        }

        // Initialize the app
        init();
    </script>
</body>
</html>